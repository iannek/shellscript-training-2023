# 演習概要
- 演習内容
  - シェルスクリプト実行時に引数を渡す。
  - 渡された引数の件数と中身が妥当であるかをチェックし、処理結果を表示する。

- 演習目標
  - シェルスクリプトへの引数の渡し方、使い方を理解する。
  - 引数として用いる特殊変数を理解する。


# 演習内容

## 課題1. 引数の処理を行うシェルスクリプト
以下の処理を行うシェルスクリプトのファイル(tr_7_1.sh)を作成・実行する。  
  - シェルスクリプト実行時に1つ目の引数として5,2つ目の引数として8を渡す。
  - 引数に関して以下の2つの条件の判定を行い、結果に応じて処理を分岐する。
    - 条件1
      - 渡された引数の数が2個であるかを判定する。
        - 2個である場合…2つ目の条件の判定処理に移る。
        - 2個でない場合…"引数指定不備"とターミナル上に出力して処理を終了する。
    - 条件2
      - 引数の値が5,8であるかを判定する。
        - 5,8である場合…引数を足し合わせて結果をターミナル上に出力する。
        - 5,8でない場合…"引数指定不備"とターミナル上に出力して処理を終了する。

## 発展問題
課題1の条件2を以下の通り変更した場合のシェルスクリプトを作成する
- 渡された引数が数字であるかを判定する。
    - 数字である場合…引数を足し合わせて結果をターミナル上に出力する。
    - 数字でない場合…"引数指定不備"とターミナル上に出力して処理を終了する。

# ヒント
## 課題1
<details><summary>講義資料参考ページ</summary><div>

- 特殊変数
  - p39
- 条件指定
  - p82
- メタキャラクタ
  - p89
</div></details>

<details><summary>引数の参照方法</summary><div>

特殊変数を使用することでシェルスクリプト内で引数を参照できる。  
例えば、コマンド`bash tr_7_1.sh 5 8`という形式で実行されたシェルスクリプトの場合、
特殊変数`$#`、`$1`、`$2`をechoなどで出力してみると、それぞれ`2`、`5`、`8`という値となっていることがわかる。(各特殊変数の意味は講義資料p39参照)


</div></details>

<details><summary>複数条件指定</summary><div>

複数条件が真である場合のみ処理を行いたい場合、下記のように記述する。

p82に記載されている"条件式1 -a 条件式2"の指定方法を利用して、
``` sh
[ $# -eq 2 -a $1 -eq 5 -a $2 -eq 8 ]
```

またはp89に記載されているメタキャラクタ"&&"を利用して
``` sh
[ $# -eq 2 ] && [ $1 -eq 5 ] && [ $2 -eq 8 ]
```

なお、上記２つの指定方法は次のように混ざっていても良い。

``` sh
[ $# -eq 2 ] && [ $1 -eq 5 -a $2 -eq 8 ]
```

</div></details>


## 発展問題
<details><summary>講義資料参考ページ</summary><div>

- 特殊変数
  - p39
- 条件指定
  - p82
- メタキャラクタ
  - p90
</div></details>

<details><summary>解くための指針</summary><div>

- 直接数字であるかどうかの判定はできないため、コマンド`expr`で計算を行いその終了ステータスで判定する。

</div></details>

<details><summary>複数条件指定</summary><div>

複数条件のいずれかが真である場合のみ処理を行いたい場合、下記のように記述する。

p82に記載されている"条件式1 -o 条件式2"の指定方法を利用して、
``` sh
[ $# -eq 2 -a $1 -eq 5 -o $2 -eq 8 ]
```

またはp89に記載されているメタキャラクタ"&&"を利用して
``` sh
[ $# -eq 2 ] && [ $1 -eq 5 ] || [ $2 -eq 8 ]
```

</div></details>

# 演習解答  

<details><summary>解答例</summary><div>

## 課題1. 引数の処理を行うシェルスクリプト  解答例  
シェルスクリプトファイル"tr_7_1.sh"をエディタから作成し、下記の内容を書き込む。  

``` sh
#!/bin/bash
if [ $# -eq 2 ] && [ $1 -eq 5 ] && [ $2 -eq 8 ]; then # または if [ $# -eq 2 -a $1 -eq 5 -a $2 -eq 8 ]; then
  echo $(($1 + $2))
else
  echo "引数指定不備"
fi
```
<details><summary>課題1のシェルスクリプトの内容解説</summary><div>

- `$#`　…　引数の個数を参照する特殊変数。講義資料p39を参照。
- `$数字`　…　数字番目の引数の値を参照する特殊変数。講義資料p39を参照。
- `&&` …　前のコマンドが正常終了時のみ後続のコマンドを実行する。そのため、複数の条件が真であることを指定したい場合に使用可能。前のtestコマンドが真のときのみ次のtestコマンドを実行するため。講義資料p89を参照。
- `-a` …　"条件式1 -a 条件式2" のように記載することで、条件式1が真かつ条件式2が真であれば真となる。講義資料p82を参照。  
※ `&&`と`-a`は次のように混ざっていても良い
  - `if [ $# = 2 ] && [ $1 = 5 -a $2 = 8 ];`
</div></details>

tr_7_1.shを実行する。  

```
bash tr_7_1.sh 5 8
```

計算結果が表示されることを確認。  
(以下は上記の例の場合の表示)

```
13
```

引数の数が誤っている場合や渡された値が誤っている場合は"引数指定不備"と表示されることを確認する。

コマンド例  
```
bash tr_7_1.sh 5
```

```
bash tr_7_1.sh 5 7
```


出力結果を確認  

```
引数指定不備
```


## 引数の処理を行うシェルスクリプト(発展問題解答例)  

``` sh
#!/bin/bash
expr $1 + $2 > /dev/null 2>&1 # 計算処理を行いエラー結果は出力しない
RET=$? # exprの終了ステータスを代入する。計算結果が0以外の場合0が、計算結果が0の場合は1が代入される。

if [ $# -eq 2 ] && [ $RET -eq 0 ] || [ $RET -eq 1 ]; then # または if [ $# -eq 2 -a $1 -eq 5 -o $2 -eq 8 ]; then
  echo $(($1 + $2))
else
  echo "引数指定不備"
fi
```
<details><summary>発展問題のシェルスクリプトの内容解説</summary><div>

- 引数を用いてexprの計算処理を行い、その終了ステータスを利用することで引数が数字かどうかを判定する。注意点としてはexprの終了ステータスが少し特殊で、計算結果が0以外のときは0、計算結果が0のときは1になること。このため終了ステータスが0または1かを条件で判定させる必要がある。
- `||` …　前のコマンドが異常終了時のみ後続のコマンドを実行する。そのため複数の条件のどちらかが真であることを指定したい場合に使用可能。前のtestコマンドが真であればそこで判定を終了し、偽であれば次のtestコマンドを実行するため。講義資料p90を参照。
- `-o` …　"条件式1 -o 条件式2" のように記載することで、条件式1が真もしくは条件式2が真であれば真となる。講義資料p82を参照。
</div></details>


</div></details>

## [次の演習(演習8)](./演習8.md)